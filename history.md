# 지정/등록 문화재 정보 사이트 풀스택 개발 히스토리

## 2021. 3. 28. ~ 31.

-   구상
    -   그동안 써보지 않았던 언어와 프레임워크를 공부하기 위해 간략한 기획을 했다.
    -   무엇을 하는게 가장 시간이 덜 들면서 효율적으로 코딩하고 공부할 수 있을까?
    -   일단 기술적인 것보다도 콘텐츠를 무엇으로 할지, 디자인은 어떻게 할지부터 정해야겠다.
    -   콘텐츠는 쉽게 구할 수 있으면서 양도 나름대로 방대한 것이면 좋겠다.
    -   아무래도 가장 쉽게 구할 수 있는건 공공데이터인 것 같다.
    -   공공데이터 중에서도 내용이 방대하면서 나름대로의 데이터셋이 있으면서 내가 관심있어하는 콘텐츠는 아무래도 문화재인 것 같다.
    -   공공데이터포털에서 문화재를 검색해봤다.
    -   뭔놈의 지자체들은 열심히 문화재 데이터는 만들어 올렸는데 업데이트도 하지 않는다. 지자체 문화재 정보는 그 수량도 많지 않아서 활용하기 힘들다.
    -   아무래도 역시 문화재청의 정보가 좋은 것 같다.
    -   문화재청에서 제공되는 문화재 정보를 봤다. 있다!!
-   데이터 테스트
    -   기본적으로 페이징 기반으로 목록을 가져오는 게 있고, 그 목록의 각종 아이디값을 이용하고 상세정보, 이미지정보, 동영상정보, 나레이션 음성정보가 있었다.
    -   음 근데 API 키나 그런 것 없다. 그냥 막 갖다 써도 되는가보다.
    -   http://www.cha.go.kr/cha/SearchKindOpenapiList.do 이 주소를 그냥 브라우저에 쳐봤는데 잘 나온다. 그런데 XML이다.
    -   뭐 XML을 JSON으로 바꿔주는 오픈소스가 있겠지. 하다보면 될거다.
    -   나머지 이미지, 동영상, 나레이션도 잘 된다.
    -   근데 나레이션은 음성파일 URL이 지맘대로 떨어진다. 그냥 얘는 쓰지 말자.
-   디자인 선정
    -   그럼 백엔드를 위한 데이터는 대충 됐고, 프론트엔드의 껍데기 역할을 할 디자인이 필요하다.
    -   디자인을 또 언제 만드냐, 그냥 잘 만들어진 다른 사이트꺼 카피해서 내가 마크업 하면 된다.
    -   11번가 디자인 괜찮은 것 같다. 적절히 카피해서 활용하면서 문화재에 맞게 변환해주면 되겠다.
-   기술 스택 구상
    -   내가 실무에서 써본 주력 프레임워크는 Express.js, Vue.js다. 음 근데 백엔드에서는 Nest.js, 프론트엔드에서는 React.js를 쓰는 것이 공부도 될 거고 요구하는 회사들도 많다.
    -   Nest.js는 문서도 잘 되어있고 어차피 Express.js 기반이라 별 문제가 없을 것 같다. 다만 TypeScript? 이것도 문서만 보고 그냥 하면 된다. 정적타입 언어부터 시작한 내가 별로 두려울 건 없다.
    -   React.js는 전에 공부좀 했었고 그땐 이해가 잘 안갔다. 근데 한참 실무에서 Vue.js를 쓰고 다시 문서와 예제를 보니 Vue.js하고 별로 다를 게 없다. 이것도 그냥 하면 된다. 음 그리고 Next.js를 쓰도록 하자.
    -   백엔드에 Nest.js도 좋지만 Spring 진짜 해보고 싶다. 우리나라 특성상 유달리 Spring이 많지만, 뭐 사람이 많아서 쓰는 것도 있겠지만 쓸 만 하니까 쓰는 게 아닌가. 이것도 해보자.
    -   일단 Nest.js로 먼저 백엔드를 만들어보고, 그 로직을 그대로 카피해서 Spring에도 적용시켜보자. 참 언어는 Kotlin이다. 아무래도 Java는 내 성향에 안맞다.
    -   프론트엔드에서는 API 엔드포인트를 Nest.js쪽과 Spring쪽으로 스위칭할 수 있게 하면 백엔드는 두개 만들어도 프론트엔드는 하나만 만들어도 된다.
    -   근데 Spring 프로젝트를 할 땐 이클립스는 정말 쓰기가 싫다. 인텔리제이 쓰고 싶다.
    -   인텔리제이는 돈 든다.... 어 보니까 학생은 무료 라이센스 준다!!
    -   바로 라이센스 발급받고 인텔리제이 다운받아서 적용시켜버렸다. M1도 지원한다. 쿨하다.
    -   데이터베이스는 대충 로컬에 MySql 올리고 Nest.js용 db와 Spring용 db를 만들어서 가자.
-   데이터 임포트 구상
    -   자 이제 일단 개발을 본격적으로 시작하기 전에 문화재청에서 많은 문화재들을 긁어와야 겠다.
    -   데이터셋을 보니까... 음 뭐 그대로 써도 되겠지만 그래도 백엔드를 하는거니 관계형 데이터베이스에 맞게 데이터를 가공해서 데이터베이스에 밀어넣는게 좋겠다.
    -   근데 난 DB를 두개 가져갈거고 각각 다른 ORM을 쓸거니까 Raw 데이터는 JSON으로 받아놓는게 좋겠다. 매번 데이터 많이 당겨오면 문화재청이 싫어할 수도 있다. JSON으로 받은 데이터를 백엔드 모델 구성하고 나서 밀어넣으면 될 것 같다.
-   프로젝트 기획
    -   그럼 이제 프로젝트를 어떻게 나눌까? 용도별로 나눠야겠다.
    -   일단 데이터를 가져오는 프로젝트를 만들자.
    -   그리고 백엔드는 두개를 가져갈거니까 각각 만들자.
    -   프론트엔드는 하나만 만들면 되겠다.
    -   그럼 다음과 같이 프로젝트가 구성된다.
        -   getHeritageData
        -   nest-heritage + database
        -   spring-heritage + database
        -   next-heritage
-   getHeritageData 작업
    -   이건 그냥 가장 편한 Javascript로 하자.
    -   어차피 서버 애플리케이션도 아니라 적당히 작성하면 된다.
    -   API 요청을 해보니 문화재가 16,000개가 넘는다. 난 2개의 DB에 ORM으로 데이터를 넣을 건데 이걸 두 번 작업하기에는 너무 비효율적이다. 데이터를 한 번만 받아서 json으로 저장하고 재사용해야겠다.
    -   일단 limit를 17,000개로 해놓고 목록 API를 날려보니 잘 된다.
    -   그리고 문화재 리스트의 여러 키값을 이용해서 상세정보, 이미지, 비디오를 요청해봤다. 잘 된다.
    -   근데 리스트야 전부 가져오는게 별로 무리는 없는 거 같은데, 나머지 서브 API들은 하나하나 다 요청하려니 요청을 대충 17,000 \* 3을 해야한다. 너무 많다.
    -   서브 API들은 리스트를 기반으로 전부 배열로 담아서 비동기 요청을 하면 될 것 같다. Promise.all을 쓰자
    -   을단 리스트 10개에 대해서 서브 API 3개 다 해봤더니 좀 느리긴 하지만 별 무리없이 잘 된다.
    -   그래! 이젠 10,000개가 넘는 데이터를 다 날려보자!
    -   네트워크 오류가 난다... 요청이 한꺼번에 너무 많이 와서 문화재청 서버에서 문제가 생긴듯...
    -   안되겠다. 100개씩 날려보자... 또 오류난다... 20개, 30개, 40개, 50개... 30개가 한계인 것 같다.
    -   그래서 30개로 날렸는데 그래도 하세월이다.
    -   그냥 3,000개만 가져오기로 했다.
    -   getDataAndSave 메소드를 만들어서 3,000개 가져와서 json으로 저장하는 것 끝!!!
    -   이제 makeData 메소드를 만들자.
    -   makeData 메소드는 저장된 json 데이터를 다 가져와서 DB Table 규격에 맞게, 필드명도 더 가독성 있고 의미있게 재구성할거다.
    -   원데이터는 좀 데이터베이스답지 않아서 테이블들을 관계형으로 구성하기 위해 좀 가공이 많이 필요할 것 같다.
    -   그래서 대충 모델을 짜봤다. 훌륭하다.

## 2021. 4. 1.

-   이제 데이터를 가공하자
-   중간에 못함..

## 2021. 4. 8.

-   열심히 동영상쪽 가공하고 있는데 오랜만에 해서 데이터 구조가 잘 생각이 안 남 ㅠㅠ

## 2021. 4. 10.

-   이제 겨우 동영상쪽 데이터 가공해서 저장했다.
-   프로젝트에서 젠킨스 써보자, 깃도 이제 쓰자
